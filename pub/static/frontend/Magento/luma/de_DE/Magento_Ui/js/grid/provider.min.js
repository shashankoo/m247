define(['jquery','underscore','mageUtils','rjsResolver','uiLayout','Magento_Ui/js/modal/alert','mage/translate','uiElement','uiRegistry','Magento_Ui/js/grid/data-storage'],function($,_,utils,resolver,layout,alert,$t,Element,registry){'use strict';return Element.extend({defaults:{firstLoad:true,lastError:false,storageConfig:{component:'Magento_Ui/js/grid/data-storage',provider:'${ $.storageConfig.name }',name:'${ $.name }_storage',updateUrl:'${ $.update_url }'},listens:{params:'onParamsChange',requestConfig:'updateRequestConfig'},ignoreTmpls:{data:true},triggerDataReload:false},initialize:function(){utils.limit(this,'onParamsChange',5);_.bindAll(this,'onReload');this._super().initStorage().clearData();resolver(this.reload,this);return this;},initStorage:function(){layout([this.storageConfig]);return this;},clearData:function(){this.setData({items:[],totalRecords:0,showTotalRecords:true});return this;},setData:function(data){data=this.processData(data);this.set('data',data);return this;},processData:function(data){var items=data.items;_.each(items,function(record,index){record._rowIndex=index;});return data;},reload:function(options){var request=this.storage().getData(this.params,options);this.trigger('reload');request.done(this.onReload).fail(this.onError.bind(this));return request;},onParamsChange:function(){if(!this.firstLoad){this.reload();}else{this.triggerDataReload=true;}},onError:function(xhr){if(xhr.statusText==='abort'){return;}
this.set('lastError',true);this.firstLoad=false;this.triggerDataReload=false;alert({content:$t('Something went wrong.')});},onReload:function(data){this.firstLoad=false;this.set('lastError',false);this.setData(data).trigger('reloaded');if(this.triggerDataReload){this.triggerDataReload=false;this.reload();}},updateRequestConfig:function(requestConfig){registry.get(this.storageConfig.provider,function(storage){_.extend(storage.requestConfig,requestConfig);});}});});