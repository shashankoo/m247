define(['jquery','jquery/ui','jquery/jstree/jquery.jstree'],function($){'use strict';$.widget('mage.folderTree',{options:{root:'root',rootName:'Root',url:'',currentPath:['root'],tree:{core:{themes:{dots:false},check_callback:true}}},_create:function(){var options=this.options,treeOptions=$.extend(true,{},options.tree,{core:{data:{url:options.url,type:'POST',dataType:'text',dataFilter:$.proxy(function(data){return this._convertData(JSON.parse(data));},this),data:function(node){return{node:node.id==='root'?null:node.id,'form_key':window.FORM_KEY};}}}});this.element.jstree(treeOptions).on('ready.jstree',$.proxy(this.treeLoaded,this)).on('load_node.jstree',$.proxy(this._createRootNode,this));},treeLoaded:function(){var path=this.options.currentPath,tree=this.element,lastExistentFolderEl,recursiveOpen=function(){var folderEl=$('[data-id="'+path.pop()+'"]');if(!folderEl.length){tree.jstree('select_node',lastExistentFolderEl);return;}
lastExistentFolderEl=folderEl;if(path.length){tree.jstree('open_node',folderEl,recursiveOpen);}else{tree.jstree('open_node',folderEl,function(){tree.jstree('select_node',folderEl);});}};recursiveOpen();},_createRootNode:function(event,data){var rootNode,children;if(data.node.id==='#'){rootNode={id:this.options.root,text:this.options.rootName,li_attr:{'data-id':this.options.root}};children=data.node.children;data.instance.element.jstree().create_node(null,rootNode,'first',function(){data.instance.element.jstree().move_node(children,rootNode.id);});}},_convertData:function(data){return $.map(data,function(node){return{id:node.id,text:node.text,path:node.path,li_attr:{'data-id':node.id},children:node.children};});}});return $.mage.folderTree;});